const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.copyInitialState=this.copy(t),this.status="idle",this.score=0}copy(t){return t.map(t=>[...t])}moveLeft(){if("playing"===this.status){let t=this.copy(this.initialState);for(let t=0;t<4;t++){let e=[];for(let i=0;i<4;i++)0!==this.initialState[t][i]&&e.push(this.initialState[t][i]);this.mergeCells(e);for(let i=0;i<4;i++)this.initialState[t][i]=e[i]||0}this.canMove(t,this.initialState)&&this.randomCell(),this.updateStatus()}}moveRight(){if("playing"===this.status){let t=this.copy(this.initialState);for(let t=0;t<4;t++){let e=[];for(let i=3;i>=0;i--)0!==this.initialState[t][i]&&e.push(this.initialState[t][i]);this.mergeCells(e);let i=0;for(let s=3;s>=0;s--)this.initialState[t][s]=e[i]||0,i++}this.canMove(t,this.initialState)&&this.randomCell(),this.updateStatus()}}moveUp(){if("playing"===this.status){let t=this.copy(this.initialState);for(let t=0;t<4;t++){let e=[];for(let i=0;i<4;i++)0!==this.initialState[i][t]&&e.push(this.initialState[i][t]);this.mergeCells(e);for(let i=0;i<4;i++)this.initialState[i][t]=e[i]||0}this.canMove(t,this.initialState)&&this.randomCell(),this.updateStatus()}}moveDown(){if("playing"===this.status){let t=this.copy(this.initialState);for(let t=0;t<4;t++){let e=[];for(let i=3;i>=0;i--)0!==this.initialState[i][t]&&e.push(this.initialState[i][t]);this.mergeCells(e);let i=0;for(let s=3;s>=0;s--)this.initialState[s][t]=e[i]||0,i++}this.canMove(t,this.initialState)&&this.randomCell(),this.updateStatus()}}getScore(){return this.score}getState(){return this.initialState}getStatus(){return this.status}start(){this.status="playing",this.randomCell(),this.randomCell()}restart(){this.status="idle",this.score=0,this.initialState=this.copy(this.copyInitialState)}randomCell(){let t=[];for(let e=0;e<4;e++)for(let i=0;i<4;i++)0===this.initialState[e][i]&&t.push({row:e,col:i});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:i,col:s}=t[e];this.initialState[i][s]=.1>Math.random()?4:2}}canMove(t,e){for(let i=0;i<4;i++)for(let s=0;s<4;s++)if(t[i][s]!==e[i][s])return!0;return!1}checkGameOver(t){for(let e=0;e<4;e++)for(let i=0;i<4;i++)if(0===t[e][i])return!1;for(let e=0;e<4;e++)for(let i=0;i<4;i++)if(i<3&&t[e][i]===t[e][i+1]||e<3&&t[e][i]===t[e+1][i])return!1;return!0}checkWin(t){for(let e=0;e<4;e++)for(let i=0;i<4;i++)if(2048===t[e][i])return!0;return!1}updateStatus(){"playing"===this.status&&(this.checkWin(this.initialState)?this.status="win":this.checkGameOver(this.initialState)&&(this.status="lose"))}mergeCells(t){for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&0!==t[e]&&(t[e]*=2,this.score+=t[e],t.splice(e+1,1))}};document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".game-score"),i=document.querySelector(".start"),s=document.querySelectorAll(".field-row");function a(){["start","win","lose"].forEach(t=>{let e=document.querySelector(`.message-${t}`);e&&e.classList.add("hidden")})}function l(){let i=t.getState();for(let t=0;t<i.length;t++){let e=s[t].querySelectorAll(".field-cell");for(let s=0;s<e.length;s++){let a=i[t][s],l=e[s];!function(t){Array.from(t.classList).forEach(e=>{/^field-cell--\d+$/.test(e)&&t.classList.remove(e)})}(l),0!==a?(l.classList.add(`field-cell--${a}`),l.textContent=`${a}`):l.textContent=""}}e.textContent=t.getScore()}i.addEventListener("click",()=>{"idle"===t.getStatus()?(t.start(),a(),l(),i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart"):function(){t.restart(),a(),l(),i.classList.remove("restart"),i.classList.add("start"),i.textContent="Start";let e=document.querySelector(".message-start");e&&e.classList.remove("hidden")}()}),document.addEventListener("keydown",e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){if(e.preventDefault(),"playing"!==t.getStatus())return;let i=JSON.stringify(t.getState()),s=t.getScore();switch(e.key){case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}let a=JSON.stringify(t.getState()),r=t.getScore();(i!==a||s!==r)&&(l(),function(t){if("win"===t||"lose"===t){let e=document.querySelector(`.message-${t}`);e&&e.classList.remove("hidden")}}(t.getStatus()))}}),l()});
//# sourceMappingURL=index.21ac7779.js.map
